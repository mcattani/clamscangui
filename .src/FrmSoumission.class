' Gambas class file

'' ' *********************************************************************************************************
'' ' Ce programme est un logiciel libre; vous pouvez le redistribuer ou le modifier suivant
'' ' les termes de la GNU General Public License telle que publiée par la Free Software Foundation ;
'' ' soit la version 3 de la licence, soit( à votre gré) toute version ultérieure.
'' ' Ce programme est distribué dans l'espoir qu'il sera utile, mais SANS AUCUNE GARANTIE ;
'' ' sans même la garantie tacite de QUALITÉ MARCHANDE ou d'ADÉQUATION à UN BUT PARTICULIER.
'' ' Consultez la GNU General Public License pour plus de détails.
'' ' Vous devez avoir reçu une copie de la GNU General Public License en même temps que ce programme ;
'' ' si ce n 'est pas le cas, consultez <http://www.gnu.org/licenses>.
'' ' *********************************************************************************************************

Private hProc As Process

Public Sub Run() As Boolean

     Return Not Me.ShowModal()

End

Public Sub Form_Open()

     TAFichier.Text = FrmGeneral.fichier[FrmGeneral.myRow]                      'fichier sélectionné
     TAVirus.Text = FrmGeneral.virus[FrmGeneral.myRow]                          'virus afférant

     TBCourriel.Text = FMain.email
     TBNom.Text = FMain.nom

End

Public Sub btnEnviar_Click()

     Dim Comm As String

     If TBCourriel.Text = "" Or TBNom.Text = "" Then
          Message(("¡llena todos los campos!"))
          Return
     Endif

     If TAFichier.Text = "" Or TAVirus.Text = "" Then
          Message(("¡no tienes que enviar nada! "))
          Return
     Endif
     'commande clamsubmit pour envoyer une soumission de faux positif au serveur de clamav
     Comm = "clamsubmit -e " & FMain.email & " -N " & FMain.nom & " -p " & TAFichier.Text & " -V " & TAVirus.Text

     If FMain.bSudo = True Then
          Authenticate.Command("sudo " & Comm)
          If FMain.bFlag = True Then                                            'montexte est affecté à la commande du process
               hProc = Shell (FMain.monTexte) & " 2>&1" For Read As "Scan"
               TournProc
          Endif
     Else If FMain.bsudo = False
          hProc = Shell (Comm) & " 2>&1" For Read As "Scan"
          TournProc
     Endif
     Wait
     Me.Mouse = Mouse.Default
     TextArea3.Mouse = Mouse.Default
     FMain.monTexte = ""

End

Public Sub Scan_read()                                                          'affichage dans terminal

     Dim sLine As String

     Read #hProc, sline, Lof(hproc)
     TextArea3.Text &= sLine
     TextArea3.EnsureVisible()

End

Public Sub TournProc()                                                          'tant que tourne le process

     While hProc.state = hProc.Running
          Wait 1
          Me.Mouse = Mouse.Wait
          TextArea3.Mouse = Mouse.Wait
     Wend

End

Public Sub btnCancel_Click()

     Me.Close

End

Public Sub TBCourriel_Leave()                                                   'enregistrement de l'adresse mail pour l'envoi

     Settings["General/courriel"] = TBCourriel.Text
     Settings.Save

End

Public Sub TBNom_Leave()                                                        'enregistrement du nom pour l'envoi

     Settings["General/nom"] = TBNom.Text
     Settings.Save

End

Public Sub btnCerrar_Click()

     Me.Close(True)

End
