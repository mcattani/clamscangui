' Gambas class file

'' ' *********************************************************************************************************
'' ' Ce programme est un logiciel libre; vous pouvez le redistribuer ou le modifier suivant
'' ' les termes de la GNU General Public License telle que publiée par la Free Software Foundation ;
'' ' soit la version 3 de la licence, soit( à votre gré) toute version ultérieure.
'' ' Ce programme est distribué dans l'espoir qu'il sera utile, mais SANS AUCUNE GARANTIE ;
'' ' sans même la garantie tacite de QUALITÉ MARCHANDE ou d'ADÉQUATION à UN BUT PARTICULIER.
'' ' Consultez la GNU General Public License pour plus de détails.
'' ' Vous devez avoir reçu une copie de la GNU General Public License en même temps que ce programme ;
'' ' si ce n 'est pas le cas, consultez <http://www.gnu.org/licenses>.
'' ' *********************************************************************************************************

'' TODO reste à changer la sélection unique par une sélection multiple
'' Changer myRow (integer) par myRow[](integer[])

Public myRow As Integer
Public fichier As String[] = New String[]
Public virus As String[] = New String[]
Public lNbrLigne As Long

Public Sub Run() As Boolean

     Return Not Me.ShowModal()

End

Public Sub Form_KeyPress()                                                      'pour sortie immédiate

     If Key.code = Key.Esc Then Me.Close

End

Public Sub btnCerrar_Click()                                                    'fermeture

     FMain.txSalida.Clear
     Me.Close()

End

Public Sub GV1_Select()

     myRow = GV1.Row

End

Public Sub btnImpr_Click()                                                      'impression

     Dim hreport As Report
     Dim Parties As String[]

     Parties = Split(TextArea1.Text, gb.NewLine)
     hreport = New Impr1(Parties)
     hreport.preview()

End

Public Sub btnSauve_Click()                                                     'bouton sauvegarde en fonction de iFlag

     Dim Comm As String
     Dim Comm1 As String
     Dim nomFich As String

     Message.Title = ("¡Proceda con cuidado!")
     If Message.Question(("¿Quieres guardar tus cambios?"), ("Si"), ("No")) = 2 Then
          Me.Close(True)
     Else
          Select Case FMain.iFlag                                               'en fonction du drapeau integer
               Case 0
                    nomFich = User.Home &/ ".clamscangui/clamd.pil"
                    File.Save(nomFich, TextArea1.Text)
                    Comm = "cp -a  " & nomFich & " " & "/etc/clamav/clamd.conf"
                    ' Comm1 = " systemctl restart clamav-daemon"
                    comm1 = " /etc/init.d/clamav-daemon start"

               Case 1
                    nomFich = User.Home &/ ".clamscangui/freshclam.pil"
                    File.Save(nomFich, TextArea1.Text)
                    Comm = "cp -a  " & nomFich & " " & "/etc/clamav/freshclam.conf"
                    ' Comm1 = " systemctl restart freshclam"
                    comm1 = " /etc/init.d/clamav-freshclam start"

               Case 2
                    nomFich = User.Home &/ ".clamscangui/clamav-milter.pil"
                    File.Save(nomFich, TextArea1.Text)
                    Comm = "cp -a  " & nomFich & " " & "/etc/clamav/clamav-milter.conf"
                    ' Comm1 = " systemctl restart clamav-milter"
                    comm1 = " /etc/init.d/clamav-milter start"

               Case 3
                    nomFich = User.Home &/ ".clamscangui/clamd.exemple"
                    File.Save(nomFich, TextArea1.Text)

               Case 4
                    nomFich = User.Home &/ ".clamscangui/freshclam.exemple"
                    File.Save(nomFich, TextArea1.Text)

               Case 5
                    nomFich = User.Home &/ ".clamscangui/clamav-milter.exemple"
                    File.Save(nomFich, TextArea1.Text)

          End Select

          Authenticate.Command("sudo " & Comm)                                  'on récupère le mot de passe
          Shell (FMain.monTexte)                                                'on lance le process
          If FMain.bFlag = True Then                                            'message en fonction du résultat
               If Not Error Then
                    Message.Info(("Copia de seguridad realizada"))
               Else
                    Message.Info(("Copia de seguridad no realizada") & " " & Error.Text)
               Endif
          Else
               Message.Info(("Copia de seguridad no realizada"))
          Endif
          Authenticate.Command("sudo " & Comm1)
          Shell (FMain.monTexte)

     Endif
     FMain.monTexte = ""
Catch
     Message(Error.Text)

End

Public Sub btnRestaurar_Click()

     Dim hFile As File
     Dim sLine As String
     Dim i As Integer

     Select Case FMain.iform
          Case 3                                                                'Config

               Dim Comm As String
               Dim Comm1 As String
               Dim nomFich As String

               Message.Title = ("¡Proceda con cuidado!")
               If Message.Question(("¿Quiere restaurar el archivo respaldado?"), ("Si"), ("No")) = 2 Then
                    Me.Close(True)
               Else
                    Select Case FMain.iFlag                                     'en fonction du drapeau integer
                         Case 0
                              nomFich = User.Home &/ ".clamscangui/clamd.sauve"
                              TextArea1.Text = File.load(nomFich)
                              Comm = "cp -a  " & nomFich & " " & "/etc/clamav/clamd.conf"
                              ' comm1 = " systemctl restart clamav-daemon"
                              comm1 = " /etc/init.d/clamav-daemon start"

                         Case 1
                              nomFich = User.Home &/ ".clamscangui/freshclam.sauve"
                              TextArea1.Text = File.load(nomFich)
                              Comm = "cp -a  " & nomFich & " " & "/etc/clamav/freshclam.conf"
                              ' comm1 = " systemctl restart freshclam"
                              comm1 = " /etc/init.d/clamav-freshclam start"

                         Case 2
                              nomFich = User.Home &/ ".clamscangui/clamav-milter.sauve"
                              TextArea1.Text = File.load(nomFich)
                              Comm = "cp -a  " & nomFich & " " & "/etc/clamav/clamav-milter.conf"
                              ' comm1 = " systemctl restart clamav-milter"
                              comm1 = " /etc/init.d/clamav-milter start"

                         Case 3
                              nomFich = "/usr/share/doc/clamav-daemon/examples/clamd.conf.sample"
                              TextArea1.Text = File.load(nomFich)
                              Comm = "cp -a  " & nomFich & " " & "User.Home &/.clamscangui/clamd.exemple"

                         Case 4
                              nomFich = "/usr/share/doc/clamav-freshclam/examples/freshclam.conf.sample"
                              TextArea1.Text = File.load(nomFich)
                              Comm = "cp -a  " & nomFich & " " & User.Home &/ ".clamscangui/freshclam.exemple"

                         Case 5
                              nomFich = "/usr/share/doc/clamav-milter/examples/clamav-milter.conf.sample"
                              TextArea1.Text = File.load(nomFich)
                              Comm = "cp -a  " & nomFich & " " & User.Home &/ ".clamscangui/clamav-milter.exemple"

                    End Select

                    Authenticate.Command("sudo " & Comm)                        'on récupère le mot de passe
                    Shell (FMain.monTexte)                                      'on lance le process
                    If FMain.bFlag = True Then                                  'message en fonction du résultat
                         If Not Error Then
                              Message.Info(("Restauración realizada"))
                         Else
                              Message.Info(("Restauración no realizada") & " " & Error.Text)
                         Endif
                    Else
                         Message.Info(("Restauración no realizada"))
                    Endif
                    Authenticate.Command("sudo " & Comm1)
                    Shell (FMain.monTexte)
                    FMain.monTexte = ""
               Endif

          Case 5                                                                'liste des fichiers en quarantaine
               If GV1.Rows.Selection.Max < 0 Then
                    Message(("No hay archivo para restaurar"))
                    Return
               Endif
               If Message.Warning(("¿Quieres restaurar el archivo de la cuarentena?"), ("Si"), ("No")) = 2 Then
                    Return
               Endif
               Try Shell "cp -a " & User.Home &/ ".clamscangui/viruses" &/ File.Name(fichier[myRow]) & " " & fichier[myRow]
               Wait
               If Not Error Then
                    Message(("El archivo ha sido restaurado"))
               Else
                    Message(("¡El archivo en cuestión no existe!"))
               Endif
               Try Kill User.Home &/ ".clamscangui/viruses" &/ File.Name(fichier[myRow])
               GV1.Rows.Remove(myRow, 1)
               hFile = Open FMain.liste For Create
               For i = 0 To GV1.Rows.Max
                    sLine &= fichier[i] & ": " & virus[i] & " FOUND" & gb.NewLine
               Next
               File.Save(FMain.liste, sLine)
               sLine = ""
               ' miseAjour(FMain.liste)
     End Select

Catch
     Message(Error.Text)

End

Public Sub _New() 'Form_Open()

     Dim ceTexte As String

     Select Case FMain.iform
          Case 0                                                                'FrmHistoric
               btnSauve.Visible = False
               btnBorrar.Visible = True
               btnImpr.visible = True
               btnRestaurar.Visible = False
               btnCerrar.Visible = True
               btnSubmission.Visible = False
               btnQuarant.Visible = False
               Label1.Text = ("Historial de escaneo:")
               TextArea1.Visible = True
               GV1.Visible = False

               If Not Exist(FMain.historic) Then
                    FMain.histo = Open FMain.historic For Create
               Else
                    FMain.histo = Open FMain.historic For Input
               Endif

               Me.Text = ("Historia de ClamScanGui : ") & FMain.historic
               TextArea1.Pos = 0
               TextArea1.Alignment = Align.Normal

               Try Shell " cat " & FMain.historic & " | wc -l " To ceTexte      'combien de lignes dans le fichier?
               lNbrLigne = Val(ceTexte)

               If lNbrLigne > 3000 Then
                    Message.Title = ("¡Atención, archivo muy grande!")
                    If Message.Question(("¿Quieres ver el archivo completo? \n ¡Ten paciencia!"), ("Si"), ("¡Solo una parte!")) = 1 Then
                         Try Shell " cat " & FMain.historic To TextArea1.Text   'affiche tout le fichier
                    Else
                         Try Shell " tail -n 2000 " & FMain.historic To TextArea1.Text    'affiche la queue du fichier 2000 lignes
                    Endif
               Else
                    Try Shell " cat " & FMain.historic To TextArea1.Text        'affiche tout le fichier
               Endif

               If TextArea1.Text = "" Then
                    TextArea1.Alignment = Align.Center
                    TextArea1.Text = (" -------- | Archivo vacío | -------- ")  'fichier vide
               Endif

          Case 1                                                                'FrmLog
               btnSauve.Visible = False
               btnBorrar.Visible = False
               btnImpr.visible = True
               btnRestaurar.Visible = False
               btnCerrar.Visible = True
               btnSubmission.Visible = False
               btnQuarant.Visible = False
               Label1.Text = ("Grabación de la sesión:")
               TextArea1.Visible = True
               GV1.Visible = False

               Me.Text = (" Registro de ClamScanGui ") & FMain.clamLog ' User.Home &/ ".clamscangui/ClamScanGui_Log.txt"
               FMain.clamLog = User.Home &/ ".clamscangui/ClamScanGui_Log.txt"

               TextArea1.Pos = 0
               TextArea1.Alignment = Align.Normal
               TextArea1.Text = File.Load(FMain.clamLog)
               If TextArea1.Text = "" Then
                    TextArea1.Alignment = Align.Center
                    TextArea1.Text = (" -------- | Archivo vacío | -------- ")
               Endif

          Case 2                                                                'frmFresh
               Dim COMM As String

               btnSauve.Visible = False
               btnBorrar.Visible = False
               btnImpr.visible = True
               btnRestaurar.Visible = False
               btnCerrar.Visible = True
               btnSubmission.Visible = False
               btnQuarant.Visible = False
               Label1.Text = ("Viendo el archivo Freshclam.log:") & " /var/log/clamav/freshclam.log"
               TextArea1.Visible = True
               GV1.Visible = False

               COMM = "cat /var/log/clamav/freshclam.log"                       'affichage de fresclam.log
               Shell (comm) To TextArea1.Text

          Case 3                                                                'Config
               Dim nomFich As String

               btnSauve.Visible = False
               btnBorrar.Visible = False
               btnImpr.visible = True
               btnRestaurar.Visible = True
               btnCerrar.Visible = True
               btnSubmission.Visible = False
               btnQuarant.Visible = False
               GV1.Visible = False

               If FMain.bTBSudo = True And (FMain.iFlag = 0 Or FMain.iFlag = 1 Or FMain.iFlag = 2) Then                                               'affichage des boutons de restauration et de sauvegarde
                    TextArea1.ReadOnly = False
                    btnSauve.Visible = True
                    btnRestaurar.Visible = True
                    Me.Caption = ("# Modo de edición # ") & " --- " & Application.Name & " --- " & " # " & (" Configuración de: ")
                    Me.Background = Color.Red
                    Label1.Text = ("Edición:") & gb.NewLine
               Else                                                             'non affichage boutons restauration et sauvegarde
                    TextArea1.ReadOnly = True
                    btnSauve.Visible = False
                    btnRestaurar.Visible = False
                    Me.Caption = ("# Modo de consulta # ") & " --- " & Application.Name & " -- " & " # " & (" Configuración de: ")
                    Me.Background = Color.Default
                    Label1.Text = ("Consulta:") & gb.NewLine
               Endif

               Select Case FMain.iFlag                                          'en fonction du drapeau integer

                    Case 0    'clamd
                         TextArea1.Text = File.Load("/etc/clamav/clamd.conf")
                         Me.Caption = Me.Caption & " clamd.conf" & " # "
                         nomFich = User.Home &/ ".clamscangui/clamd.sauve"
                         Label1.Text = Label1.text & gb.NewLine & ("Su archivo de configuración clamd.conf")

                    Case 1    'freshclam
                         TextArea1.Text = File.Load("/etc/clamav/freshclam.conf")
                         Me.Caption = Me.Caption & " freshclam.conf" & " # "
                         nomFich = User.Home &/ ".clamscangui/freshclam.sauve"
                         Label1.Text = Label1.text & gb.NewLine & ("Su archivo de configuración Freshclam.conf")

                    Case 2    'milter
                         TextArea1.Text = File.Load("/etc/clamav/clamav-milter.conf")
                         Me.Caption = Me.Caption & " clamav-milter.conf" & " # "
                         nomFich = User.Home &/ ".clamscangui/clamav-milter.sauve"
                         Label1.Text = Label1.text & gb.NewLine & ("Su archivo de configuración clamav-milter.conf")

                         '********** exemples ****************
                    Case 3
                         TextArea1.Text = File.Load("/usr/share/doc/clamav-daemon/examples/clamd.conf.sample")
                         Me.Caption = (" Ejemplo de clamd.conf ")
                         Label1.Text = Label1.text & gb.NewLine & ("Un ejemplo de un archivo de configuración con comentarios\n que puede encontrar en su disco en:\n")
                         Label1.Text = Label1.Text & "/usr/share/doc/clamav-daemon/examples/clamd.conf.sample"
                         nomFich = User.Home &/ "Clamav/clamd.exemple"

                    Case 4
                         TextArea1.Text = File.Load("/usr/share/doc/clamav-freshclam/examples/freshclam.conf.sample")
                         Me.Caption = (" Ejemplo de freshclam.conf ")
                         Label1.Text = Label1.text & gb.NewLine & ("Un ejemplo de un archivo de configuración con comentarios\n que puede encontrar en su disco en:\n")
                         Label1.Text = Label1.Text & "/usr/share/doc/clamav-freshclam/examples/freshclam.conf.sample"
                         nomFich = User.Home &/ "Clamav/freshclam.exemple"

                    Case 5
                         TextArea1.Text = File.Load("/usr/share/doc/clamav-milter/examples/clamav-milter.conf.sample")
                         Me.Caption = (" Ejemplo de clamav-milter.conf ")
                         Label1.Text = Label1.text & gb.NewLine & ("Un ejemplo de un archivo de configuración con comentarios\n que puede encontrar en su disco en:\n")
                         Label1.Text = Label1.Text & "/usr/share/doc/clamav-milter/examples/clamav-milter.conf.sample"
                         nomFich = User.Home &/ "Clamav/clamav-milter.exemple"

               End Select

               If Not Exist(nomFich) And FMain.bTBSudo = True And (FMain.iFlag = 0 Or FMain.iFlag = 1 Or FMain.iFlag = 2) Then                        'la première fois seulement et si TBSudo enfoncé
                    File.Save(nomFich, TextArea1.Text)
                    Message.Title = (("Es la primera vez !") & "  ~ " & File.Name(nomFich))
                    Message.Info(("Se acaba de realizar una copia de seguridad \nen caso de error, puede restaurarla")) ' Message de rappel
               Endif

               If Not Exist(nomFich) And FMain.bTBSudo = True And (FMain.iFlag = 3 Or FMain.iFlag = 4 Or FMain.iFlag = 5) Then
                    File.Save(nomFich, TextArea1.Text)
                    Message.Title = (("Es la primera vez !") & "  ~ " & File.Name(nomFich))
                    Message.Info(("Se acaba de guardar un archivo de ejemplo \n en el siguiente directorio: \n ") & nomFich)
               Endif

               TextArea1.pos = 0
               TextArea1.EnsureVisible()

          Case 4                                                                'Aide
               btnSauve.Visible = False
               btnBorrar.Visible = False
               btnImpr.visible = True
               btnRestaurar.Visible = False
               btnCerrar.Visible = True
               btnSubmission.Visible = False
               btnQuarant.Visible = False
               Label1.Text = ("Ayuda de ClamScanGui:")
               TextArea1.Visible = True
               GV1.Visible = False

               TextArea1.Text = gb.CrLf
               TextArea1.Text = TextArea1.Text & "  |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|  " & (" Inicio de archivo ") & "  |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|  " & gb.CrLf
               TextArea1.Text = TextArea1.Text & File.Load("clamscan.txt")
               TextArea1.Text = TextArea1.Text & "  |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|  " & (" FAQ : http://www.clamav.net") & "  |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|  " & gb.CrLf & gb.CrLf

               If Settings["General/LangInit"] = "fr" Then
                    TextArea1.Text = TextArea1.Text & File.Load("FAQ_fr.txt")
               Else If Settings["General/LangInit"] = "en" Then
                    TextArea1.Text = TextArea1.Text & File.Load("FAQ_en.txt")
               Else If Settings["General/LangInit"] = "es" Then
                    TextArea1.Text = TextArea1.Text & File.Load("FAQ_es.txt")
               Endif

               TextArea1.Text = TextArea1.Text & gb.CrLf & "  |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|  " & (" Ayuda de ClamScanGui ") & "  |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|  " & gb.CrLf & gb.CrLf

               If Settings["General/LangInit"] = "fr" Then
                    TextArea1.Text = TextArea1.Text & File.Load("Aide_fr.txt")
               Else If Settings["General/LangInit"] = "en" Then
                    TextArea1.Text = TextArea1.Text & File.Load("Aide_en.txt")
               Else If Settings["General/LangInit"] = "es" Then
                    TextArea1.Text = TextArea1.Text & File.Load("Aide_es.txt")
               Endif

               TextArea1.Text = TextArea1.Text & gb.CrLf & "  |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|  " & (" Fin del documento ") & "  |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|  " & gb.CrLf

               TextArea1.Pos = 0

          Case 5                                                                'Quarantaine
               btnSauve.Visible = False
               btnBorrar.Visible = True
               btnImpr.visible = False
               btnRestaurar.Visible = True
               btnCerrar.Visible = True
               btnSubmission.Visible = True
               btnQuarant.Visible = False
               Label1.Text = ("Cuarentena de ClamScanGui:")
               TextArea1.Visible = False
               GV1.Visible = True
               Me.Text = ("Cuarentena de ClamScanGui")
               GV1.AddColumn(("Archivos infectados"), -1, Align.Center)
               GV1.AddColumn(("Virus"), -1, Align.center)

               miseAjour(FMain.liste)

          Case 6                                                                'liste des virus
               btnSauve.Visible = False
               btnBorrar.Visible = True
               btnImpr.visible = False
               btnRestaurar.Visible = False
               btnCerrar.Visible = True
               btnSubmission.Visible = True
               btnQuarant.Visible = True
               Label1.Text = ("Lista de virus encontrados")
               TextArea1.Visible = False
               GV1.Visible = True
               Me.Text = ("Lista de virus encontrados")
               GV1.AddColumn(("Archivos infectados"), -1, Align.Center)
               GV1.AddColumn(("Virus"), -1, Align.center)

               miseAjour(FMain.pil)

     End Select
Catch
     Message.Info((Error.Text))

End

Public Sub miseAjour(fich As String)

     Dim hFile As File
     Dim sLine As String
     Dim i As Integer

     hFile = Open fich For Input                                                'ouverture en lecture du fichier concerné
     i = 0
     While Not Eof(hFile)
          Line Input #hFile, sLine                                              'sLine de la forme /path complet: nom virus FOUND
          fichier.Add(Mid(sLine, 1, RInStr(sLine, ":") - 1), i)                 'récupération du path complet
          virus.Add(Left(Mid(sLine, InStr(sLine, ":") + 2), -6), i)             'récupération du nom virus
          i += 1                                                                'incrément de i
     Wend
     GV1.Rows.Count = i                                                         'nombre de ligne du gridview

     For i = 0 To GV1.Rows.Max                                                  'remplissage du GridView GV1
          GV1[i, 0].Text = fichier[i]                                           'col 0 =path complet
          GV1[i, 1].Text = virus[i]                                             'col 1 =nom virus
     Next

End

Public Sub btnBorrar_Click()                                                    'effacer

     Dim i As Integer
     Dim sLine As String
     Dim hFile As File

     Select Case FMain.iform

          Case 0                                                                'historique
               TextArea1.Text = ""
               If Exist(FMain.historic) Then                                    'effacement du fichier
                    Try Kill FMain.historic
               Endif

          Case 5, 6                                                             'quarantaine ou liste des virus trouvés
               If GV1.Rows.Selection.Max < 0 Then
                    Message(("No hay archivo para borrar"))
                    Return
               Endif
               If Message.Warning(("¿Quieres destruir el archivo?"), ("Si"), ("No")) = 2 Then
                    Return
               Endif

               Try Kill fichier[myRow]

               If Not Error Then
                    Message(("¡El archivo ha sido destruido!"))
               Else
                    Message(("¡El archivo en cuestión no existe!"))
               Endif

               fichier.Extract(myRow, 1)
               virus.Extract(myRow, 1)
               GV1.Rows.Remove(myRow, 1)

               If FMain.iForm = 5 Then                                     'liste de la quarantaine
                    hFile = Open FMain.liste For Create                    'vérifier nécessité de create et non append
                    For i = 0 To GV1.Rows.Max
                         sLine = sLine & fichier[i] & ": " & virus[i] & " FOUND" & gb.NewLine
                    Next
                    File.Save(FMain.liste, sLine)
                    sLine = ""
                    ' miseAjour(FMain.liste)                                 'inutile ici
               Else If FMain.iForm = 6 Then                                'liste des potentiellement corrompus
                    hFile = Open FMain.pil For Create                      'vérifier nécessité de create et non append
                    For i = 0 To GV1.Rows.Max
                         sLine = sLine & fichier[i] & ": " & virus[i] & " FOUND" & gb.NewLine
                    Next
                    File.Save(FMain.pil, sLine)
                    sLine = ""
                    ' miseAjour(FMain.pil)                                   'inutile ici
               Endif

     End Select

Catch
     Message.Info((Error.Text))

End

Public Sub btnSubmission_Click()                                                'soumission à clamav de faux positifs

     FMain.email = Settings["General/courriel"]
     FMain.nom = Settings["General/nom"]

     If GV1.Rows.Selection.Max < 0 Then
          Message(("No hay archivo para enviar"))
          Return
     Endif

     Select Case FMain.iForm

          Case 5, 6
               FrmSoumission.ShowModal()

     End Select

Catch
     Message.Info((Error.Text))

End

Public Sub btnQuarant_Click()                                                   'mise en quarantaine des virus sélectionnés

     Dim hFile2 As File
     Dim i As Integer
     Dim sLine As String

     Select Case FMain.iForm
          Case 6
               If GV1.Rows.Selection.Max < 0 Then
                    Message(("No hay archivo para borrar"))
                    Return
               Endif
               If Message.Warning(("¿Quieres poner el archivo en cuarentena?"), ("Si"), ("No")) = 2 Then
                    Return
               Endif
               Try Shell "cp -a " & fichier[myRow] & " " & User.Home &/ ".clamscangui/viruses" &/ File.Name(fichier[myRow])
               Wait
               If Not Error Then
                    Message(("El archivo se ha movido a cuarentena"))
               Else
                    Message(("¡El archivo en cuestión no existe!"))
               Endif
               sLine = File.Load(FMain.liste) & fichier[myRow] & ": " & virus[myRow] & " FOUND" & gb.NewLine
               File.Save(FMain.liste, sLine)
               sLine = ""
               ' miseAjour(FMain.liste)
               Try Kill fichier[myRow]
               GV1.Rows.Remove(myRow, 1)
               hFile2 = Open FMain.pil For Create
               For i = 0 To GV1.Rows.Max
                    sLine &= fichier[i] & ": " & virus[i] & " FOUND" & gb.NewLine
               Next
               File.Save(FMain.pil, sLine)
               sLine = ""
               ' miseAjour(FMain.pil)
     End Select

Catch
     Message.Info((Error.Text))

End
